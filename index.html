<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agendamento - Barbeiro Dom Valdenon</title>
<style>
body { font-family: Arial; background:#121212; color:#fff; text-align:center; margin:0; padding:0;}
header{background:#000; padding:20px;}
header img{max-width:200px;}
h1{margin:10px 0; color:#FFD700;}
.container{padding:20px; max-width:400px; margin:auto; background:#1a1a1a; border-radius:10px; box-shadow:0 0 10px #FFD700;}
label{display:block; margin-top:15px; text-align:left;}
input, select, button{width:100%; padding:10px; margin-top:5px; border-radius:5px; border:none; font-size:16px;}
button{background:#FFD700; color:#000; font-weight:bold; cursor:pointer; margin-top:20px;}
.success{background:#28a745; padding:10px; border-radius:5px; margin-top:20px; display:none;}
</style>
</head>
<body>

<header>
  <img src="logo.png" alt="Barbeiro Dom Valdenon">
  <h1>Agende seu horário</h1>
</header>

<div class="container">
  <form id="agendamentoForm">
    <label for="servico">Escolha o serviço:</label>
    <select id="servico" required>
      <option value="">Selecione</option>
      <option value="Corte Simples - 30min">Corte Simples - 30min</option>
      <option value="Barba - 30min">Barba - 30min</option>
      <option value="Corte Fade - 40min">Corte Fade - 40min</option>
      <option value="Corte + Barba - 60min">Corte + Barba - 60min</option>
    </select>

    <label for="data">Escolha a data:</label>
    <input type="date" id="data" required>

    <label for="hora">Escolha o horário:</label>
    <select id="hora" required></select>

    <label for="nome">Nome:</label>
    <input type="text" id="nome" placeholder="Seu nome" required>

    <label for="telefone">WhatsApp:</label>
    <input type="tel" id="telefone" placeholder="(xx) xxxxx-xxxx" required>

    <button type="submit">Agendar</button>
  </form>
  <div class="success" id="successMsg">Agendamento realizado com sucesso!</div>
</div>

<script>
const horaSelect = document.getElementById("hora");
const dataInput = document.getElementById("data");
const form = document.getElementById("agendamentoForm");
const successMsg = document.getElementById("successMsg");

const horasDisponiveis = ["09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00"];

// Substitua pelo URL do seu Web App do Google Sheets
const SHEET_URL = "COLE_AQUI_SEU_URL_DO_WEB_APP";
const SHEET_GET = SHEET_URL+"?action=getHorarios";

dataInput.addEventListener("change", async ()=>{
  const selectedDate = dataInput.value;
  horaSelect.innerHTML = "<option value=''>Selecione</option>";
  try {
    const res = await fetch(SHEET_GET);
    const ocupados = await res.json();
    let horariosDia = horasDisponiveis;
    if(ocupados[selectedDate]){
      horariosDia = horasDisponiveis.filter(h => !ocupados[selectedDate].includes(h));
    }
    horariosDia.forEach(h => {
      const option = document.createElement("option");
      option.value = h;
      option.textContent = h;
      horaSelect.appendChild(option);
    });
  } catch(err){
    alert("Erro ao buscar horários ocupados.");
  }
});

form.addEventListener("submit", async (e)=>{
  e.preventDefault();
  const agendamento = {
    servico: form.servico.value,
    data: form.data.value,
    hora: form.hora.value,
    nome: form.nome.value,
    telefone: form.telefone.value
  };
  try {
    const res = await fetch(SHEET_URL, {
      method:"POST",
      body: JSON.stringify(agendamento)
    });
    const result = await res.json();
    if(result.status==="success"){
      successMsg.style.display = "block";
      form.reset();
      horaSelect.innerHTML = "<option value=''>Selecione</option>";
      setTimeout(()=>{successMsg.style.display="none"},3000);
    } else {
      alert(result.mensagem);
    }
  } catch(err){
    alert("Erro ao conectar com a planilha.");
  }
});
</script>

</body>
</html>
